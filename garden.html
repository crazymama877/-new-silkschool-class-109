<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404ç­æ—©è¯»èŠ±å›­</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'å¾®è½¯é›…é»‘', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 8px solid #ffcc5c;
        }
        
        /* æ ‡é¢˜æ æ ·å¼ */
        .header {
            background: linear-gradient(to right, #6ecbf5, #059dc5);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            border-bottom: 5px solid #ffcc5c;
        }
        
        .title-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .title {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .edit-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .edit-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            gap: 15px;
        }
        
        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .start-btn {
            background: linear-gradient(to right, #43e97b, #38f9d7);
            color: #056a3f;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        .stop-btn {
            background: linear-gradient(to right, #ff6b6b, #ff8e8e);
            color: white;
        }
        
        .stop-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        .report-btn {
            background: linear-gradient(to right, #a18cd1, #fbc2eb);
            color: white;
        }
        
        .report-btn:hover {
            transform: translateY(-3px);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        /* èŠ±å›­åŒºåŸŸ */
        .garden-area {
            flex: 3;
            padding: 30px;
            background: linear-gradient(to bottom, #c5f9d7, #f5f5d6);
            position: relative;
            overflow: hidden;
            min-height: 600px;
        }
        
        .garden-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23c5f9d7"/><circle cx="20" cy="20" r="5" fill="%2387e487" opacity="0.3"/><circle cx="80" cy="40" r="8" fill="%2387e487" opacity="0.3"/><circle cx="50" cy="80" r="6" fill="%2387e487" opacity="0.3"/><circle cx="70" cy="15" r="4" fill="%2387e487" opacity="0.3"/></svg>');
            z-index: 1;
        }
        
        .garden-content {
            position: relative;
            z-index: 2;
            height: 100%;
        }
        
        .flower-container {
            position: absolute;
            transition: transform 0.5s;
        }
        
        .flower {
            position: relative;
            width: 100px;
            height: 120px;
        }
        
        .stem {
            position: absolute;
            width: 6px;
            height: 80px;
            background: linear-gradient(to bottom, #4CAF50, #2E7D32);
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 3px;
        }
        
        .leaf {
            position: absolute;
            width: 20px;
            height: 12px;
            background-color: #4CAF50;
            border-radius: 50%;
            transform: rotate(45deg);
        }
        
        .leaf.left {
            left: 15px;
            top: 40px;
        }
        
        .leaf.right {
            right: 15px;
            top: 30px;
            transform: rotate(-45deg);
        }
        
        .seed {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #8B4513;
            border-radius: 50%;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .sprout {
            position: absolute;
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #8BC34A, #4CAF50);
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 4px;
        }
        
        .seedling {
            position: absolute;
            width: 8px;
            height: 40px;
            background: linear-gradient(to bottom, #8BC34A, #4CAF50);
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 4px;
        }
        
        .seedling::before, .seedling::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 12px;
            background-color: #8BC34A;
            border-radius: 50%;
            top: 15px;
        }
        
        .seedling::before {
            left: -10px;
            transform: rotate(-30deg);
        }
        
        .seedling::after {
            right: -10px;
            transform: rotate(30deg);
        }
        
        .bud {
            position: absolute;
            width: 20px;
            height: 25px;
            background: linear-gradient(to bottom, #FF4081, #F50057);
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50% 50% 40% 40%;
        }
        
        .petal {
            position: absolute;
            width: 25px;
            height: 35px;
            background: linear-gradient(to bottom, #FF4081, #F50057);
            border-radius: 50%;
        }
        
        .petal.center {
            width: 30px;
            height: 30px;
            background: #FFEB3B;
            z-index: 3;
        }
        
        .natural-disaster {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: opacity 1s;
        }
        
        .rain {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 95%, rgba(173, 216, 230, 0.7) 100%);
            background-size: 100% 10px;
            animation: rainFall 0.8s linear infinite;
        }
        
        .wind {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent 95%, rgba(255, 255, 255, 0.5) 100%);
            background-size: 20px 100%;
            animation: windBlow 1.5s linear infinite;
        }
        
        @keyframes rainFall {
            0% { background-position: 0 0; }
            100% { background-position: 0 10px; }
        }
        
        @keyframes windBlow {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }
        
        /* ä¾§è¾¹ä¿¡æ¯é¢æ¿ */
        .info-panel {
            flex: 1;
            padding: 25px;
            background: linear-gradient(to bottom, #f9f7ff, #e6f3ff);
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .info-box {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 6px solid #6ecbf5;
        }
        
        .info-title {
            font-size: 1.3rem;
            color: #059dc5;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .decibel-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: #056a3f;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .decibel-status {
            text-align: center;
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50px;
            margin-top: 10px;
        }
        
        .good {
            background-color: rgba(76, 175, 80, 0.2);
            color: #2E7D32;
        }
        
        .bad {
            background-color: rgba(244, 67, 54, 0.2);
            color: #D32F2F;
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #43e97b, #38f9d7);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .timer {
            font-size: 1.8rem;
            text-align: center;
            font-weight: bold;
            color: #059dc5;
            margin: 10px 0;
        }
        
        .flower-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #F50057;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .history-date {
            font-weight: bold;
        }
        
        .history-flowers {
            color: #F50057;
            font-weight: bold;
        }
        
        /* æŠ¥å‘Šå¼¹çª— */
        .report-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        
        .report-content {
            background-color: white;
            width: 90%;
            max-width: 700px;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #666;
            cursor: pointer;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .report-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .report-stat {
            background: linear-gradient(to right, #f9f7ff, #e6f3ff);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .report-stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #059dc5;
            margin: 10px 0;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .control-panel {
                width: 100%;
                justify-content: center;
            }
            
            .title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜æ  -->
        <div class="header">
            <div class="title-area">
                <h1 class="title" id="class-title">404ç­æ—©è¯»èŠ±å›­</h1>
                <button class="edit-btn" id="edit-title-btn">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
            <div class="control-panel">
                <button class="control-btn start-btn" id="start-btn">
                    <i class="fas fa-play"></i> å¼€å§‹æ—©è¯»
                </button>
                <button class="control-btn stop-btn" id="stop-btn" disabled>
                    <i class="fas fa-stop"></i> ç»“æŸæ—©è¯»
                </button>
                <button class="control-btn report-btn" id="report-btn">
                    <i class="fas fa-chart-bar"></i> æˆé•¿æŠ¥å‘Š
                </button>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- èŠ±å›­åŒºåŸŸ -->
            <div class="garden-area">
                <div class="garden-bg"></div>
                <div class="garden-content" id="garden-content">
                    <!-- èŠ±æœµå°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
                <div class="natural-disaster" id="natural-disaster"></div>
            </div>
            
            <!-- ä¿¡æ¯é¢æ¿ -->
            <div class="info-panel">
                <!-- åˆ†è´æ£€æµ‹ -->
                <div class="info-box">
                    <h2 class="info-title">
                        <i class="fas fa-volume-up"></i> æ—©è¯»éŸ³é‡
                    </h2>
                    <div class="decibel-display" id="decibel-display">--</div>
                    <div class="decibel-status" id="decibel-status">ç­‰å¾…æ£€æµ‹...</div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>æˆé•¿è¿›åº¦</span>
                            <span id="progress-percent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <!-- è®¡æ—¶å™¨ -->
                <div class="info-box">
                    <h2 class="info-title">
                        <i class="fas fa-clock"></i> æ—©è¯»è®¡æ—¶
                    </h2>
                    <div class="timer" id="timer">00:00</div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>æ—©è¯»è¿›åº¦</span>
                            <span id="reading-progress">0/15åˆ†é’Ÿ</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="reading-progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <!-- èŠ±å›­ç»Ÿè®¡ -->
                <div class="info-box">
                    <h2 class="info-title">
                        <i class="fas fa-seedling"></i> èŠ±å›­ç»Ÿè®¡
                    </h2>
                    <div class="flower-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="total-flowers">0</div>
                            <div class="stat-label">ç«ç‘°èŠ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="seeds">0</div>
                            <div class="stat-label">ç§å­</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="max-duration">0</div>
                            <div class="stat-label">æœ€é•¿è¾¾æ ‡(ç§’)</div>
                        </div>
                    </div>
                </div>
                
                <!-- å†å²è®°å½• -->
                <div class="info-box">
                    <h2 class="info-title">
                        <i class="fas fa-history"></i> ä»Šæ—¥è®°å½•
                    </h2>
                    <div class="history-list" id="history-list">
                        <!-- å†å²è®°å½•å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æŠ¥å‘Šå¼¹çª— -->
    <div class="report-modal" id="report-modal">
        <div class="report-content">
            <button class="close-btn" id="close-report-btn">&times;</button>
            <div class="report-header">
                <h2><span id="report-class-title">404ç­</span>æ—©è¯»æˆé•¿æŠ¥å‘Š</h2>
                <p id="report-date">2023å¹´10æœˆ20æ—¥</p>
            </div>
            <div class="report-stats">
                <div class="report-stat">
                    <h3>ç«ç‘°èŠ±æ•°é‡</h3>
                    <div class="report-stat-value" id="report-total-flowers">0</div>
                    <p>å…¨ç­å…±åŒåŠªåŠ›çš„æˆæœ</p>
                </div>
                <div class="report-stat">
                    <h3>æ—©è¯»æ€»æ—¶é•¿</h3>
                    <div class="report-stat-value" id="report-total-time">0</div>
                    <p>åˆ†é’Ÿ</p>
                </div>
                <div class="report-stat">
                    <h3>æœ€é•¿è¾¾æ ‡æ—¶é•¿</h3>
                    <div class="report-stat-value" id="report-max-duration">0</div>
                    <p>ç§’</p>
                </div>
                <div class="report-stat">
                    <h3>éŸ³é‡è¾¾æ ‡ç‡</h3>
                    <div class="report-stat-value" id="report-compliance-rate">0%</div>
                    <p>ä¿æŒè‰¯å¥½æ—©è¯»çŠ¶æ€</p>
                </div>
            </div>
            <div class="info-box">
                <h2 class="info-title">
                    <i class="fasfa-award"></i> ä»Šæ—¥è¯„ä»·
                </h2>
                <p id="report-evaluation">ç­‰å¾…ç”Ÿæˆè¯„ä»·...</p>
            </div>
            <div class="info-box">
                <h2 class="info-title">
                    <i class="fas fa-bullseye"></i> æ˜æ—¥ç›®æ ‡
                </h2>
                <p id="report-next-goal">ç­‰å¾…ç”Ÿæˆç›®æ ‡...</p>
            </div>
        </div>
    </div>
    
    <script>
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const state = {
            isReading: false,
            decibelLevel: 0,
            decibelHistory: [],
            flowers: [],
            seeds: [],
            currentGrowthStage: 0,
            growthTimer: 0,
            totalReadingTime: 0,
            goodReadingTime: 0,
            maxContinuousGoodTime: 0,
            currentContinuousGoodTime: 0,
            startTime: null,
            timerInterval: null,
            decibelInterval: null,
            currentFlowerId: 0,
            disasterActive: false,
            growthStages: [
                { name: "ç§å­", duration: 10, element: "seed" },
                { name: "å‘èŠ½", duration: 20, element: "sprout" },
                { name: "å°è‹—", duration: 30, element: "seedling" },
                { name: "èŠ±è‹", duration: 20, element: "bud" },
                { name: "å¼€èŠ±", duration: 30, element: "flower" }
            ],
            historyRecords: []
        };

        // DOM å…ƒç´ 
        const elements = {
            classTitle: document.getElementById('class-title'),
            editTitleBtn: document.getElementById('edit-title-btn'),
            startBtn: document.getElementById('start-btn'),
            stopBtn: document.getElementById('stop-btn'),
            reportBtn: document.getElementById('report-btn'),
            decibelDisplay: document.getElementById('decibel-display'),
            decibelStatus: document.getElementById('decibel-status'),
            progressFill: document.getElementById('progress-fill'),
            progressPercent: document.getElementById('progress-percent'),
            timer: document.getElementById('timer'),
            readingProgress: document.getElementById('reading-progress'),
            readingProgressFill: document.getElementById('reading-progress-fill'),
            totalFlowers: document.getElementById('total-flowers'),
            seedsCount: document.getElementById('seeds'),
            maxDuration: document.getElementById('max-duration'),
            gardenContent: document.getElementById('garden-content'),
            naturalDisaster: document.getElementById('natural-disaster'),
            historyList: document.getElementById('history-list'),
            reportModal: document.getElementById('report-modal'),
            closeReportBtn: document.getElementById('close-report-btn'),
            reportClassTitle: document.getElementById('report-class-title'),
            reportDate: document.getElementById('report-date'),
            reportTotalFlowers: document.getElementById('report-total-flowers'),
            reportTotalTime: document.getElementById('report-total-time'),
            reportMaxDuration: document.getElementById('report-max-duration'),
            reportComplianceRate: document.getElementById('report-compliance-rate'),
            reportEvaluation: document.getElementById('report-evaluation'),
            reportNextGoal: document.getElementById('report-next-goal')
        };

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // åŠ è½½å†å²è®°å½•
            loadHistory();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // åˆå§‹åŒ–èŠ±å›­
            initGarden();
            
            // æ¨¡æ‹Ÿåˆå§‹å†å²è®°å½•
            simulateInitialHistory();
            
            // æ›´æ–°UI
            updateUI();
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ç¼–è¾‘ç­çº§åç§°
            elements.editTitleBtn.addEventListener('click', () => {
                const newTitle = prompt('è¯·è¾“å…¥æ–°çš„ç­çº§åç§°ï¼š', elements.classTitle.textContent);
                if (newTitle && newTitle.trim() !== '') {
                    elements.classTitle.textContent = newTitle.trim();
                    saveToLocalStorage('classTitle', newTitle.trim());
                }
            });

            // å¼€å§‹æ—©è¯»
            elements.startBtn.addEventListener('click', startReading);

            // ç»“æŸæ—©è¯»
            elements.stopBtn.addEventListener('click', stopReading);

            // æŸ¥çœ‹æŠ¥å‘Š
            elements.reportBtn.addEventListener('click', showReport);

            // å…³é—­æŠ¥å‘Š
            elements.closeReportBtn.addEventListener('click', () => {
                elements.reportModal.style.display = 'none';
            });

            // ç‚¹å‡»æŠ¥å‘Šå¼¹çª—å¤–åŒºåŸŸå…³é—­
            elements.reportModal.addEventListener('click', (e) => {
                if (e.target === elements.reportModal) {
                    elements.reportModal.style.display = 'none';
                }
            });
        }

        // åˆå§‹åŒ–èŠ±å›­
        function initGarden() {
            // æ¸…ç©ºèŠ±å›­
            elements.gardenContent.innerHTML = '';
            
            // å¦‚æœæœ‰ä¿å­˜çš„èŠ±æœµï¼ŒåŠ è½½å®ƒä»¬
            const savedFlowers = getFromLocalStorage('flowers');
            if (savedFlowers && savedFlowers.length > 0) {
                state.flowers = savedFlowers;
                state.flowers.forEach(flower => {
                    createFlowerElement(flower);
                });
            }
        }

        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const savedHistory = getFromLocalStorage('historyRecords');
            if (savedHistory) {
                state.historyRecords = savedHistory;
            }
        }

        // æ¨¡æ‹Ÿåˆå§‹å†å²è®°å½•
        function simulateInitialHistory() {
            if (state.historyRecords.length === 0) {
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                const twoDaysAgo = new Date(today);
                twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
                
                state.historyRecords = [
                    { date: formatDate(yesterday), flowers: 8, maxDuration: 45 },
                    { date: formatDate(twoDaysAgo), flowers: 6, maxDuration: 38 }
                ];
                
                saveToLocalStorage('historyRecords', state.historyRecords);
            }
            
            updateHistoryList();
        }

        // å¼€å§‹æ—©è¯»
        function startReading() {
            if (state.isReading) return;
            
            state.isReading = true;
            state.startTime = new Date();
            state.decibelHistory = [];
            state.currentContinuousGoodTime = 0;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            elements.startBtn.disabled = true;
            elements.stopBtn.disabled = false;
            
            // å¼€å§‹è®¡æ—¶å™¨
            startTimer();
            
            // å¼€å§‹åˆ†è´æ£€æµ‹
            startDecibelDetection();
            
            // æ·»åŠ å†å²è®°å½•
            addHistoryRecord('å¼€å§‹æ—©è¯»', 'info');
            
            // æ›´æ–°UI
            updateUI();
        }

        // ç»“æŸæ—©è¯»
        function stopReading() {
            if (!state.isReading) return;
            
            state.isReading = false;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            elements.startBtn.disabled = false;
            elements.stopBtn.disabled = true;
            
            // åœæ­¢è®¡æ—¶å™¨å’Œåˆ†è´æ£€æµ‹
            clearInterval(state.timerInterval);
            clearInterval(state.decibelInterval);
            
            // æ·»åŠ å†å²è®°å½•
            addHistoryRecord('ç»“æŸæ—©è¯»', 'info');
            
            // è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
            setTimeout(showReport, 500);
            
            // ä¿å­˜èŠ±æœµçŠ¶æ€
            saveToLocalStorage('flowers', state.flowers);
            
            // æ›´æ–°UI
            updateUI();
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            state.timerInterval = setInterval(() => {
                state.totalReadingTime++;
                
                // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
                const minutes = Math.floor(state.totalReadingTime / 60);
                const seconds = state.totalReadingTime % 60;
                elements.timer.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // æ›´æ–°æ—©è¯»è¿›åº¦æ¡ï¼ˆå‡è®¾æ—©è¯»æ—¶é•¿ä¸º15åˆ†é’Ÿï¼‰
                const readingDuration = 15 * 60; // 15åˆ†é’Ÿï¼Œå•ä½ç§’
                const progressPercent = Math.min(100, (state.totalReadingTime / readingDuration) * 100);
                elements.readingProgressFill.style.width = `${progressPercent}%`;
                elements.readingProgress.textContent = 
                    `${Math.floor(state.totalReadingTime/60)}/${15}åˆ†é’Ÿ`;
                
                // æ¯è¿‡ä¸€åˆ†é’Ÿæ·»åŠ ä¸€æ¡å†å²è®°å½•
                if (state.totalReadingTime % 60 === 0 && state.totalReadingTime > 0) {
                    addHistoryRecord(`å·²æŒç»­æ—©è¯» ${state.totalReadingTime/60} åˆ†é’Ÿ`, 'time');
                }
                
            }, 1000);
        }

        // å¼€å§‹åˆ†è´æ£€æµ‹
        function startDecibelDetection() {
            state.decibelInterval = setInterval(() => {
                // æ¨¡æ‹Ÿåˆ†è´æ£€æµ‹ï¼šéšæœºç”Ÿæˆ35-70åˆ†è´çš„å€¼
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è¿æ¥çœŸå®çš„éº¦å…‹é£API
                const simulatedDecibel = Math.floor(Math.random() * 35) + 35;
                
                // è®°å½•åˆ†è´å€¼
                state.decibelLevel = simulatedDecibel;
                state.decibelHistory.push({
                    time: new Date(),
                    value: simulatedDecibel
                });
                
                // ä¿æŒæœ€è¿‘100æ¡è®°å½•
                if (state.decibelHistory.length > 100) {
                    state.decibelHistory.shift();
                }
                
                // æ›´æ–°åˆ†è´æ˜¾ç¤º
                elements.decibelDisplay.textContent = simulatedDecibel;
                
                // æ£€æµ‹åˆ†è´æ˜¯å¦è¾¾æ ‡ï¼ˆâ‰¥40ï¼‰
                if (simulatedDecibel >= 40) {
                    // è¾¾æ ‡ï¼šä¿ƒè¿›ç”Ÿé•¿
                    handleGoodDecibel();
                    elements.decibelStatus.textContent = "éŸ³é‡è¾¾æ ‡ï¼ŒèŠ±å›­åœ¨ç”Ÿé•¿ï¼";
                    elements.decibelStatus.className = "decibel-status good";
                    
                    // è®°å½•è¿ç»­è¾¾æ ‡æ—¶é—´
                    state.currentContinuousGoodTime++;
                    state.goodReadingTime++;
                    
                    // æ›´æ–°æœ€é•¿è¿ç»­è¾¾æ ‡æ—¶é—´
                    if (state.currentContinuousGoodTime > state.maxContinuousGoodTime) {
                        state.maxContinuousGoodTime = state.currentContinuousGoodTime;
                    }
                    
                    // ç§»é™¤è‡ªç„¶ç¾å®³æ•ˆæœ
                    if (state.disasterActive) {
                        elements.naturalDisaster.style.opacity = '0';
                        state.disasterActive = false;
                    }
                } else {
                    // ä¸è¾¾æ ‡ï¼šè§¦å‘è‡ªç„¶ç¾å®³
                    handleBadDecibel();
                    elements.decibelStatus.textContent = "éŸ³é‡ä¸è¶³ï¼ŒèŠ±å›­æ­£åœ¨æ¯èï¼";
                    elements.decibelStatus.className = "decibel-status bad";
                    
                    // é‡ç½®è¿ç»­è¾¾æ ‡æ—¶é—´
                    state.currentContinuousGoodTime = 0;
                    
                    // æ˜¾ç¤ºè‡ªç„¶ç¾å®³æ•ˆæœ
                    if (!state.disasterActive) {
                        showNaturalDisaster();
                        state.disasterActive = true;
                    }
                }
                
                // æ›´æ–°UI
                updateUI();
                
            }, 1000); // æ¯ç§’æ£€æµ‹ä¸€æ¬¡
        }

        // å¤„ç†è¾¾æ ‡åˆ†è´
        function handleGoodDecibel() {
            // å¦‚æœå½“å‰æ²¡æœ‰èŠ±æœµåœ¨ç”Ÿé•¿ï¼Œåˆ›å»ºæ–°çš„ç§å­
            if (state.seeds.length === 0) {
                createNewSeed();
            }
            
            // ä¸ºæ¯ä¸ªç§å­å¢åŠ ç”Ÿé•¿æ—¶é—´
            state.seeds.forEach(seed => {
                seed.growthTime++;
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                const currentStage = state.growthStages[seed.stage];
                if (seed.growthTime >= currentStage.duration) {
                    // è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                    seed.stage++;
                    seed.growthTime = 0;
                    
                    // å¦‚æœå·²ç»å¼€èŠ±ï¼Œå°†ç§å­è½¬åŒ–ä¸ºèŠ±æœµ
                    if (seed.stage >= state.growthStages.length) {
                        completeFlower(seed);
                    } else {
                        // æ›´æ–°èŠ±æœµæ˜¾ç¤º
                        updateFlowerElement(seed);
                    }
                } else {
                    // æ›´æ–°ç”Ÿé•¿è¿›åº¦
                    updateFlowerProgress(seed);
                }
            });
        }

        // å¤„ç†ä¸è¾¾æ ‡åˆ†è´
        function handleBadDecibel() {
            // å¦‚æœæ²¡æœ‰ç§å­ï¼Œç›´æ¥è¿”å›
            if (state.seeds.length === 0) return;
            
            // ä¸ºæ¯ä¸ªç§å­å‡å°‘ç”Ÿé•¿æ—¶é—´ï¼ˆå€’é€€ç”Ÿé•¿ï¼‰
            state.seeds.forEach((seed, index) => {
                seed.growthTime = Math.max(0, seed.growthTime - 2);
                
                // å¦‚æœç”Ÿé•¿æ—¶é—´å½’é›¶ä¸”ä¸æ˜¯ç¬¬ä¸€é˜¶æ®µï¼Œåˆ™é€€å›ä¸Šä¸€é˜¶æ®µ
                if (seed.growthTime <= 0 && seed.stage > 0) {
                    seed.stage--;
                    seed.growthTime = state.growthStages[seed.stage].duration - 1;
                    
                    // æ›´æ–°èŠ±æœµæ˜¾ç¤º
                    updateFlowerElement(seed);
                } else if (seed.growthTime <= 0 && seed.stage === 0) {
                    // å¦‚æœç§å­é˜¶æ®µä¹Ÿå½’é›¶ï¼Œç§»é™¤ç§å­
                    removeSeed(index);
                } else {
                    // æ›´æ–°ç”Ÿé•¿è¿›åº¦
                    updateFlowerProgress(seed);
                }
            });
        }

        // åˆ›å»ºæ–°ç§å­
        function createNewSeed() {
            const seedId = `seed-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
            const newSeed = {
                id: seedId,
                stage: 0, // ç§å­é˜¶æ®µ
                growthTime: 0,
                x: Math.random() * 80 + 10, // æ°´å¹³ä½ç½®ï¼ˆç™¾åˆ†æ¯”ï¼‰
                y: Math.random() * 60 + 20  // å‚ç›´ä½ç½®ï¼ˆç™¾åˆ†æ¯”ï¼‰
            };
            
            state.seeds.push(newSeed);
            createFlowerElement(newSeed);
            
            // æ·»åŠ å†å²è®°å½•
            addHistoryRecord('æ–°ç”Ÿäº†ä¸€é¢—ç§å­ï¼', 'seed');
            
            return newSeed;
        }

        // å®ŒæˆèŠ±æœµç”Ÿé•¿
        function completeFlower(seed) {
            // ä»ç§å­åˆ—è¡¨ä¸­ç§»é™¤
            const seedIndex = state.seeds.findIndex(s => s.id === seed.id);
            if (seedIndex !== -1) {
                state.seeds.splice(seedIndex, 1);
            }
            
            // æ·»åŠ åˆ°èŠ±æœµåˆ—è¡¨
            const flower = {
                id: seed.id,
                x: seed.x,
                y: seed.y,
                createdAt: new Date()
            };
            
            state.flowers.push(flower);
            
            // æ›´æ–°èŠ±æœµæ˜¾ç¤ºä¸ºå®Œå…¨ç»½æ”¾çŠ¶æ€
            updateFlowerElement(flower, true);
            
            // æ·»åŠ å†å²è®°å½•
            addHistoryRecord('ä¸€æœµç«ç‘°èŠ±å®Œå…¨ç»½æ”¾äº†ï¼', 'flower');
            
            // åˆ›å»ºæ–°çš„ç§å­ï¼Œç»§ç»­ç”Ÿé•¿
            setTimeout(() => {
                createNewSeed();
            }, 1000);
        }

        // åˆ›å»ºèŠ±æœµå…ƒç´ 
        function createFlowerElement(flowerData, isComplete = false) {
            const flowerContainer = document.createElement('div');
            flowerContainer.className = 'flower-container';
            flowerContainer.id = flowerData.id;
            flowerContainer.style.left = `${flowerData.x}%`;
            flowerContainer.style.top = `${flowerData.y}%`;
            
            const flowerDiv = document.createElement('div');
            flowerDiv.className = 'flower';
            
            // æ ¹æ®ç”Ÿé•¿é˜¶æ®µæ·»åŠ ç›¸åº”å…ƒç´ 
            if (isComplete) {
                // å®Œå…¨ç»½æ”¾çš„ç«ç‘°èŠ±
                flowerDiv.innerHTML = `
                    <div class="stem"></div>
                    <div class="leaf left"></div>
                    <div class="leaf right"></div>
                    <div class="petal" style="top: 20px; left: 35px; transform: rotate(0deg);"></div>
                    <div class="petal" style="top: 15px; left: 50px; transform: rotate(45deg);"></div>
                    <div class="petal" style="top: 25px; left: 60px; transform: rotate(90deg);"></div>
                    <div class="petal" style="top: 40px; left: 60px; transform: rotate(135deg);"></div>
                    <div class="petal" style="top: 50px; left: 50px; transform: rotate(180deg);"></div>
                    <div class="petal" style="top: 45px; left: 35px; transform: rotate(225deg);"></div>
                    <div class="petal" style="top: 35px; left: 25px; transform: rotate(270deg);"></div>
                    <div class="petal" style="top: 20px; left: 25px; transform: rotate(315deg);"></div>
                    <div class="petal center" style="top: 35px; left: 42px;"></div>
                `;
            } else {
                // æ ¹æ®ç”Ÿé•¿é˜¶æ®µæ˜¾ç¤ºä¸åŒå½¢æ€
                const stage = state.growthStages[flowerData.stage];
                flowerDiv.innerHTML = `
                    ${flowerData.stage >= 1 ? '<div class="stem"></div>' : ''}
                    ${flowerData.stage >= 4 ? '<div class="leaf left"></div><div class="leaf right"></div>' : ''}
                    <div class="${stage.element}"></div>
                `;
            }
            
            flowerContainer.appendChild(flowerDiv);
            elements.gardenContent.appendChild(flowerContainer);
            
            // æ·»åŠ ç”Ÿé•¿è¿›åº¦æŒ‡ç¤ºå™¨ï¼ˆä»…å¯¹ç§å­é˜¶æ®µï¼‰
            if (!isComplete) {
                const progressIndicator = document.createElement('div');
                progressIndicator.className = 'growth-progress';
                progressIndicator.style.cssText = `
                    position: absolute;
                    bottom: -20px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 12px;
                    color: #056a3f;
                    white-space: nowrap;
                `;
                progressIndicator.id = `${flowerData.id}-progress`;
                flowerContainer.appendChild(progressIndicator);
                
                updateFlowerProgress(flowerData);
            }
        }

        // æ›´æ–°èŠ±æœµå…ƒç´ 
        function updateFlowerElement(flowerData, isComplete = false) {
            const existingFlower = document.getElementById(flowerData.id);
            if (existingFlower) {
                existingFlower.remove();
            }
            
            createFlowerElement(flowerData, isComplete);
        }

        // æ›´æ–°èŠ±æœµç”Ÿé•¿è¿›åº¦
        function updateFlowerProgress(flowerData) {
            const progressElement = document.getElementById(`${flowerData.id}-progress`);
            if (progressElement) {
                const currentStage = state.growthStages[flowerData.stage];
                const progressPercent = Math.min(100, (flowerData.growthTime / currentStage.duration) * 100);
                progressElement.textContent = `${currentStage.name} ${progressPercent.toFixed(0)}%`;
            }
            
            // æ›´æ–°æ€»è¿›åº¦æ¡
            if (state.seeds.length > 0) {
                const seed = state.seeds[0]; // æ˜¾ç¤ºç¬¬ä¸€ä¸ªç§å­çš„è¿›åº¦
                const currentStage = state.growthStages[seed.stage];
                const totalStages = state.growthStages.length;
                const stageProgress = seed.growthTime / currentStage.duration;
                const totalProgress = ((seed.stage + stageProgress) / totalStages) * 100;
                
                elements.progressFill.style.width = `${totalProgress}%`;
                elements.progressPercent.textContent = `${totalProgress.toFixed(0)}%`;
            }
        }

        // ç§»é™¤ç§å­
        function removeSeed(index) {
            const seed = state.seeds[index];
            if (seed) {
                // ä»DOMä¸­ç§»é™¤
                const seedElement = document.getElementById(seed.id);
                if (seedElement) {
                    seedElement.remove();
                }
                
                // ä»æ•°ç»„ä¸­ç§»é™¤
                state.seeds.splice(index, 1);
                
                // æ·»åŠ å†å²è®°å½•
                addHistoryRecord('ä¸€é¢—ç§å­æ¯èæ¶ˆå¤±äº†', 'wither');
            }
        }

        // æ˜¾ç¤ºè‡ªç„¶ç¾å®³æ•ˆæœ
        function showNaturalDisaster() {
            // éšæœºé€‰æ‹©è‡ªç„¶ç¾å®³ç±»å‹
            const disasterType = Math.random() > 0.5 ? 'rain' : 'wind';
            
            elements.naturalDisaster.innerHTML = '';
            elements.naturalDisaster.style.opacity = '0.7';
            
            const disasterElement = document.createElement('div');
            disasterElement.className = disasterType;
            elements.naturalDisaster.appendChild(disasterElement);
            
            // 30ç§’åè‡ªåŠ¨æ·¡åŒ–æ•ˆæœ
            setTimeout(() => {
                elements.naturalDisaster.style.opacity = '0';
            }, 30000);
        }

        // æ·»åŠ å†å²è®°å½•
        function addHistoryRecord(text, type = 'info') {
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const record = {
                time: timeString,
                text: text,
                type: type
            };
            
            // æ·»åŠ åˆ°å†å²è®°å½•åˆ—è¡¨
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            let icon = 'ğŸ“';
            if (type === 'seed') icon = 'ğŸŒ±';
            if (type === 'flower') icon = 'ğŸŒ¹';
            if (type === 'wither') icon = 'ğŸ‚';
            if (type === 'time') icon = 'â±ï¸';
            
            historyItem.innerHTML = `
                <span>${timeString} ${icon}</span>
                <span>${text}</span>
            `;
            
            elements.historyList.prepend(historyItem);
            
            // ä¿æŒæœ€å¤š10æ¡è®°å½•æ˜¾ç¤º
            const items = elements.historyList.querySelectorAll('.history-item');
            if (items.length > 10) {
                items[items.length - 1].remove();
            }
        }

        // æ˜¾ç¤ºæˆé•¿æŠ¥å‘Š
        function showReport() {
            // æ›´æ–°æŠ¥å‘Šæ•°æ®
            const totalMinutes = Math.floor(state.totalReadingTime / 60);
            const complianceRate = state.totalReadingTime > 0 
                ? Math.floor((state.goodReadingTime / state.totalReadingTime) * 100) 
                : 0;
            
            elements.reportClassTitle.textContent = elements.classTitle.textContent;
            elements.reportDate.textContent = formatDate(new Date());
            elements.reportTotalFlowers.textContent = state.flowers.length;
            elements.reportTotalTime.textContent = totalMinutes;
            elements.reportMaxDuration.textContent = state.maxContinuousGoodTime;
            elements.reportComplianceRate.textContent = `${complianceRate}%`;
            
            // ç”Ÿæˆè¯„ä»·
            let evaluation = '';
            if (state.flowers.length >= 10) {
                evaluation = 'å¤ªæ£’äº†ï¼ä»Šå¤©çš„èŠ±å›­ç¹èŠ±ä¼¼é”¦ï¼ŒåŒå­¦ä»¬æ—©è¯»éå¸¸è®¤çœŸï¼';
            } else if (state.flowers.length >= 5) {
                evaluation = 'å¾ˆä¸é”™ï¼èŠ±å›­é‡Œå¼€å‡ºäº†ä¸å°‘ç«ç‘°èŠ±ï¼Œç»§ç»­ä¿æŒï¼';
            } else if (state.flowers.length >= 1) {
                evaluation = 'æœ‰è¿›æ­¥ï¼èŠ±å›­é‡Œå¼€å‡ºäº†ç«ç‘°èŠ±ï¼Œæ˜å¤©å¯ä»¥æ›´åŠªåŠ›ï¼';
            } else {
                evaluation = 'åŠ æ²¹ï¼æ˜å¤©æ—©ç‚¹å¼€å§‹ï¼Œè®©èŠ±å›­é‡Œå¼€æ»¡ç«ç‘°èŠ±å§ï¼';
            }
            elements.reportEvaluation.textContent = evaluation;
            
            // ç”Ÿæˆæ˜æ—¥ç›®æ ‡
            const nextGoal = `æ˜å¤©ç›®æ ‡ï¼š${state.flowers.length + 3}æœµç«ç‘°èŠ±ï¼Œæœ€é•¿è¾¾æ ‡${state.maxContinuousGoodTime + 10}ç§’`;
            elements.reportNextGoal.textContent = nextGoal;
            
            // æ˜¾ç¤ºæŠ¥å‘Š
            elements.reportModal.style.display = 'flex';
            
            // ä¿å­˜å†å²è®°å½•
            if (state.totalReadingTime > 60) { // è‡³å°‘æ—©è¯»äº†1åˆ†é’Ÿæ‰ä¿å­˜è®°å½•
                const todayRecord = {
                    date: formatDate(new Date()),
                    flowers: state.flowers.length,
                    maxDuration: state.maxContinuousGoodTime,
                    totalTime: totalMinutes
                };
                
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰ä»Šå¤©çš„è®°å½•
                const existingIndex = state.historyRecords.findIndex(record => 
                    record.date === todayRecord.date);
                
                if (existingIndex !== -1) {
                    state.historyRecords[existingIndex] = todayRecord;
                } else {
                    state.historyRecords.unshift(todayRecord);
                }
                
                // ä¿æŒæœ€å¤š7æ¡è®°å½•
                if (state.historyRecords.length > 7) {
                    state.historyRecords.pop();
                }
                
                saveToLocalStorage('historyRecords', state.historyRecords);
                updateHistoryList();
            }
        }

        // æ›´æ–°å†å²è®°å½•åˆ—è¡¨
        function updateHistoryList() {
            elements.historyList.innerHTML = '';
            
            state.historyRecords.forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <span class="history-date">${record.date}</span>
                    <span>ğŸŒ¹ <span class="history-flowers">${record.flowers}æœµ</span> | æœ€é•¿: ${record.maxDuration}ç§’</span>
                `;
                elements.historyList.appendChild(historyItem);
            });
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°èŠ±æœµæ•°é‡
            elements.totalFlowers.textContent = state.flowers.length;
            elements.seedsCount.textContent = state.seeds.length;
            elements.maxDuration.textContent = state.maxContinuousGoodTime;
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }

        // å·¥å…·å‡½æ•°ï¼šæœ¬åœ°å­˜å‚¨
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(`morningGarden_${key}`, JSON.stringify(value));
            } catch (e) {
                console.error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', e);
            }
        }

        function getFromLocalStorage(key) {
            try {
                const item = localStorage.getItem(`morningGarden_${key}`);
                return item ? JSON.parse(item) : null;
            } catch (e) {
                console.error('ä»æœ¬åœ°å­˜å‚¨è¯»å–å¤±è´¥:', e);
                return null;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', init);
        
        // åŠ è½½ä¿å­˜çš„ç­çº§åç§°
        const savedTitle = getFromLocalStorage('classTitle');
        if (savedTitle) {
            elements.classTitle.textContent = savedTitle;
        }
    </script>
</body>
</html>